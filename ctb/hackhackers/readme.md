# Hack hackers
ctb, 400 points

> Похоже, кого-то взломали

*Hint* (-100): Зайди на 2ip.ru и в исходный код страницы

## Write-up

Открываем страницу. Видим «взломанный сайт», за который просят 1337 биткоинов.
Также видим ошибку внизу страницы, сообщающую о том, что лог не удается записать.
Но куда же пишется лог? Обращаем внимание, что страница грузится достаточно долго
(*это было неверно, если у вас публичный IP и поднят SSH-сервер*). Значит, какие-то
данные всё ещё передаются. Открываем исходный код. И что мы видим?

```
<!-- Error occured: timed out while connecting to root@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to user@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to admin@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to oracle@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to john@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to test@176.59.13.251:22 -->
<!-- Error occured: timed out while connecting to user@176.59.13.251:22 -->
```

Кто-то пытается подключиться по SSH? Но к кому? Давайте узнаем, что это за IP-адрес 
такой: 176.59.13.251. В этот момент участник должен быть в замешательстве, потому
что IP-адрес действительно недоступен. Но рано или поздно должно прийти озарение: это
публичный IP-адрес того же юзера, который заходит на сайт!

То есть сервер пытается подключиться к клиенту. Судя по логам — со стандартными логинами
или паролями. Это похоже на поведение ботнета или чего-то такого. Подумаем: а как эта штука
попала на сам сервер? Наверное, через один из логинов/паролей из этого списка.

Что ж, осталось узнать логин и пароль, с которым к нам пытаются подключиться. Для этого есть 
два принципиально разных пути:

1. Пропатчить OpenSSH
2. Поставить honeypot

Про первый [можно почитать, например, тут](http://www.adeptus-mechanicus.com/codex/logsshp/logsshp.html)
(по запросу `patch openssh to log password attempts` можно найти и другие варианты), а я расскажу про второй.
Среди ханипотов много вариантов на любой вкус, я выбрал [kippo](https://github.com/desaster/kippo). 
Устанавливаем СУБД MySQL, настраиваем хранение логинов и паролей в базе данных. После запуска, сделаем запрос 
на сервер и посмотрим таблицу `auth` в базе данных. Там видим шесть стандартных логинов и паролей, и один 
необычный: `john:correcthorsebatterystaple` ([пароль взят из известной картинки с xkcd](https://xkcd.com/936/)).

Пробуем его и вуаля! В домашней папке юзера лежит флаг, таск решен :)

Этот таск был, по нашему мнению, самым сложным (кроме misc), поэтому респект двум командам официального 
зачёта и трём командам неофициального зачёта, решившим его! Это очень круто!

Флаг: **uctf_botnets_make_more_bugs**
