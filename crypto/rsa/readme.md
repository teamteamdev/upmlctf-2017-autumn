# Hack RSA
crypto, 200 points

> Ден любит шифрование. Недавно он узнал о RSA и сразу написал себе 
> крутой алгоритм для получения RSA-ключей. Теперь он обменивается с 
> другом зашифрованными сообщениями, и их никак не расшифровать.
> 
> Мы даже публичный ключ нашли, но мы бессильны.

[Вложение 1](public.pem) | [Вложение 2](letter.dat)

*Hint* (-150): Приватный ключ RSA - пара (n, d), с помощью него можно расшифровать текст. В этом таске d < 1/3 * N^(1/4).

## Write-up

RSA представляет класс асимметричных шифров, о которых можно почитать
[тут](https://ru.wikipedia.org/wiki/RSA).

Нам дали только публичный ключ, а для расшифровки нужен приватный (очевидно, он хранится у Дена).

Публичный ключ — пара чисел (N, e). Приватный — (N, d), причем N = p * q, где p и q — простые, phi(n) = (p - 1) * (q - 1) — функция Эйлера, а для d выполняется равенство: (e * d) mod phi(n) = 1.

То есть чтобы посчитать d, нам нужно знать phi(n), для этого же нужно разложить n в произведение двух чисел, что является трудоёмкой задачей — в этом и состоит суть RSA.

Но, бывают случаи, когда один из параметров «нехороший» и 
его легко подобрать. Этот случай как раз такой — по данным жюри, 
было сгенерировано слишком маленькое d (см. подсказку). Это как раз то, 
что нужно для [атаки Винера](https://en.wikipedia.org/wiki/Wiener%27s_attack).

В этот раз я не буду писать эксплойт и рассказывать, почему он такой.
Поступим проще: ведь наверняка кому-то раньше встречалась атака Винера 
(да и вообще слабый ключ RSA) — нагуглим `CTF RSA attack`. Первая же
ссылка приводит нас на [RSACTFTool](https://github.com/Ganapati/RsaCtfTool).

Процесс его установки (как по мне) похож на танцы с бубном, но давайте попробуем:

1. Ставим **второй** python, pip к нему и git
2. Берем библиотеку `libnum` из необходимых пакетов со страницы репозитория: `pip install git+https://github.com/hellman/libnum.git`
3. Скачиваем RSACTFTool: `git clone https://github.com/Ganapati/RsaCtfTool`
4. Переходим в соответствующую директорию: `cd RsaCtfTool`
5. Устанавливаем остальные зависимости: `pip install -r requirements.txt`

Готово! Если в этом разобраться, то это проще, чем писать свой эксплойт 
атаки на RSA (а ведь он может быть и неудачным).

Теперь запускаем `python RsaCtfTool.py --publickey public.pem --uncipher letter.dat` и получаем флаг через несколько секунд.

Флаг: **uctfyouwonrsaencryption**
